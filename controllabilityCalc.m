% A = [-0.183 -0.779 -2.254;
%     0.512 0.770 1.995;
%     2.409 -0.265 0.192];
% B = [1.815 2.126;
%     0.314 -3.854
%     -2.663 0.519];
% C = [1 0 0;
%     0 1 0;
%     0 0 1];
% D = 0;
% 
% sys = ss(A,B,C,D);
% 
% Co = ctrb(sys.A,sys.B)
% unco = length(sys.A) - rank(Co)
% [U, S, V] = svd(Co, 'econ')
% 
% e = eig(sys.A)
% 
% 
% A = [-4.247 -4.185 -5.120;
%     4.750 4.322 4.983;
%     2.714 0 0.405];
% B = [1.660 1.912;
%     0.476 -3.631
%     -2.654 0.533];
% 
% C = [1 0 0;
%     0 1 0;
%     0 0 1];
% D = 0;
% 
% sys = ss(A,B,C,D);
% 
% Co = ctrb(sys.A,sys.B)
% unco = length(sys.A) - rank(Co)
% 
% 
% % x0' = 1.422 x0 + -1.565 x1 + -0.720 x2 + -2.021 x3 + 3.312 x4 + -1.764 u0 + 0.337 u1
% % x1' = 0.311 x1 + -0.764 x2 + -3.153 x3 + 4.069 x4 + -1.026 u0 + -0.175 u1
% % x2' = 0.585 x0 + 1.180 x1 + 7.536 x2 + 2.322 x3 + -8.140 x4 + -0.795 u0 + -2.500 u1
% % x3' = -2.566 x0 + 3.678 x1 + 0.325 x2 + -3.444 x3 + 2.700 x4 + 0.793 u0 + -1.378 u1
% % x4' = 1.421 x1 + 7.895 x2 + -4.948 x4 + -1.319 u0 + -3.386 u1
% 
% A = [1.422 -1.565 -0.720 -2.021 3.312;
%     0 0.311 -0.764 -3.153 4.069;
%     0.585 1.180 7.536 2.322 -8.140;
%     -2.566 3.678 0.325 -3.444 2.700;
%     0 1.421 7.895 0 -4.948];
% 
% B = [-1.764 0.337;
%     -1.026 -0.175;
%     -0.795 -2.500;
%     0.793 -1.378;
%     -1.319 -3.386];
% 
% C = [1 0 0 0 0;
%      0 1 0 0 0;
%      0 0 1 0 0;
%      0 0 0 1 0;
%      0 0 0 0 1];
% D = 0;
% 
% sys = ss(A,B,C,D);
% 
% Co = ctrb(sys.A,sys.B)
% unco = length(sys.A) - rank(Co)
% 
% % x0' = 4.257 1 + -2.664 x0 + -0.122 x1 + -6.536 x2 + -6.385 x3 + 8.543 x4 + -1.904 u0 + 0.260 u1
% % x1' = 1.544 1 + -1.381 x0 + 0.692 x1 + -2.910 x2 + -4.698 x3 + 5.992 x4 + -1.078 u0 + -0.204 u1
% % x2' = 0.760 1 + -0.145 x0 + 1.438 x1 + 6.497 x2 + 1.543 x3 + -7.207 x4 + -0.820 u0 + -2.514 u1
% % x3' = -5.231 1 + 2.456 x0 + 1.905 x1 + 7.473 x2 + 1.919 x3 + -3.728 x4 + 0.965 u0 + -1.283 u1
% % x4' = -0.700 1 + 0.543 x0 + 1.360 x1 + 8.900 x2 + 0.681 x3 + -5.846 x4 + -1.294 u0 + -3.373 u1
% 
% A = [-2.664 -0.122 -6.536 -6.385 8.543;
%     -1.381 0.692 -2.910 -4.698 5.992;
%     -0.145 1.438 6.497 1.543 -7.207;
%     2.456 1.905 7.473 1.919 -3.728;
%     0.543 1.360 8.900 0.681 -5.846];
% 
% B = [-1.904 0.260;
%     -1.078 -0.204
%     -0.820 -2.514
%     0.965 -1.283
%     -1.294 -3.373];
% 
% C = [1 0 0 0 0;
%      0 1 0 0 0;
%      0 0 1 0 0;
%      0 0 0 1 0;
%      0 0 0 0 1];
% D = 0;
% 
% sys = ss(A,B,C,D);
% 
% Co = ctrb(sys.A,sys.B)
% unco = length(sys.A) - rank(Co)
% 
% 
% 
% 
% A = [-291.739 1790.564 -3101.847 -960.982 8809.239 -9848.806 4125.694 -592.540 -1680.628 4317.733 -3546.105 3803.179 -8000.066 5568.549 5128.455 -8188.630 -155.974 5473.816 -3395.253 669.538;
% -80.417 428.846 10.318 -3332.862 7123.322 -6216.818 3234.441 -1799.858 -1375.549 4037.545 -1821.827 1647.447 -6374.643 4534.067 5277.673 -7695.563 -230.501 4980.652 -3009.366 580.213;
% 289.324 -1923.792 5414.758 -7726.019 4958.247 -801.749 2368.327 -4523.979 -512.232 4052.072 69.932 -838.998 -4793.367 3398.342 5710.560 -6743.409 -1562.855 5540.795 -3027.964 551.419;
% 693.896 -4471.120 11194.267 -12305.677 2505.704 4952.475 1592.310 -7589.851 619.599 3991.135 1790.046 -3137.400 -3064.336 1983.822 6041.307 -5352.769 -3227.641 6200.421 -3053.968 521.699;
% 988.854 -6288.547 15149.575 -15035.259 119.646 9295.862 993.262 -9655.866 1696.066 3465.806 2896.806 -4582.882 -1098.241 209.915 5786.960 -3484.389 -4335.161 6038.285 -2709.488 433.850;
% 1060.945 -6658.380 15614.667 -14485.442 -1704.164 10733.337 680.629 -9712.480 2427.012 2283.197 3010.787 -4627.869 986.886 -1818.068 4633.672 -1176.570 -4358.090 4574.282 -1815.843 263.528;
% 838.416 -5136.509 11602.711 -9912.783 -2493.584 8291.894 697.050 -7139.646 2573.107 454.687 1864.063 -2913.944 2914.277 -3835.260 2403.152 1585.786 -3286.703 1856.341 -415.921 20.995;
% 371.285 -2055.366 3977.218 -2312.351 -2015.765 2421.696 1024.551 -2427.562 2108.710 -1606.694 -479.563 373.400 4335.084 -5583.149 -580.092 4826.550 -2045.190 -1130.222 1066.811 -226.125;
% -210.653 1749.546 -5224.888 6287.414 -337.992 -5392.391 1550.793 3244.963 1146.961 -3235.042 -3789.151 4734.851 4948.529 -6952.640 -3683.110 8759.436 -2324.942 -2736.369 1957.766 -374.196;
% -702.758 4659.027 -11618.354 11549.555 1290.147 -10072.760 1100.396 7374.783 -192.926 -4563.562 -2647.122 4479.550 2896.549 -2651.967 -5021.093 3424.474 5547.555 -7590.735 3429.781 -552.421;
% -933.772 6003.769 -14346.637 13105.144 3274.052 -12776.131 758.978 9383.972 -1420.686 -3851.390 -3080.154 5143.823 575.420 0 -5202.984 2313.365 5046.615 -6002.242 2514.186 -379.398;
% -795.439 4771.733 -10253.173 6827.778 7045.490 -11930.671 -323.399 8660.273 -2679.439 -1222.561 -2508.731 3739.421 -2461.029 4313.689 -5156.274 527.084 4105.629 -3813.978 1468.909 -223.343;
% -349.280 1895.309 -3319.727 395.159 5363.429 -5121.805 -1280.926 4329.701 -2712.501 1500.948 -628.664 920.865 -4248.296 5110.458 -607.761 -1557.494 -1609.404 3408.088 -1837.479 331.674;
% 169.803 -1429.744 4596.862 -6795.281 3408.056 2296.599 -2234.798 -327.555 -2399.240 3921.074 1116.083 -1941.959 -4787.251 4739.148 3355.341 -2828.136 -6371.269 8945.647 -4268.884 727.539;
% 582.732 -4030.018 10615.497 -11898.386 1363.635 8114.333 -2899.725 -3805.793 -1865.448 5295.363 2101.902 -3827.250 -3893.729 2970.390 5959.444 -2951.115 -9173.673 11635.243 -5345.027 894.170;
% 795.411 -5306.610 13327.306 -13644.656 -493.859 11191.115 -3156.298 -5399.765 -1237.959 5399.660 2090.297 -4278.487 -1893.340 154.542 6929.972 -2023.357 -9726.266 11321.194 -5044.689 834.731;
% 0 -598.538 1902.237 -6770.018 0 8623.605 -477.506 -4378.292 -812.180 3081.153 1424.403 -2894.482 1918.617 -5273.844 6710.398 1127.968 -9452.731 8704.798 -3526.167 560.197;
% 793.445 -5089.628 12016.326 -10656.858 -3305.893 11674.740 -3038.019 -4768.283 75.726 3424.876 -8.929 -2076.187 3145.950 -6630.769 6172.227 1321.311 -7275.225 6166.778 -2427.773 393.243;
% 735.011 -4622.565 10549.740 -8532.701 -4319.231 11057.774 -2872.967 -4111.633 924.342 2147.955 -1445.299 -285.132 5294.751 -9924.299 5732.956 3027.372 -6064.608 3616.956 -1139.782 176.990;
% 778.998 -4828.564 10778.963 -8227.060 -5144.944 11529.224 -2785.120 -4538.974 2074.409 1281.485 -2650.771 1280.107 6732.516 -12956.954 6342.055 4368.772 -6383.942 2865.995 -640.287 86.459];
% 
% B =   [4.851 0;
%   4.648 0;
%   4.337 0;
%   3.918 0;
%   3.379 0;
%   2.790 0;
%   2.163 0;
%   1.587 0;
%   1.093 0;
%   0.709 0.404;
%   0.421 0.725;
%   0 1.171;
%   0 1.698;
%   0 2.282; 
%   0 2.862;
%   0 3.362;
%   0 3.848;
%   0 4.294;
%   0 4.632;
%   0 4.874];
% 
% C = eye(20);
% 
% D = 0;
% 
% sys = ss(A,B,C,D);
% 
% Co = ctrb(sys.A,sys.B)
% unco = length(sys.A) - rank(Co)
% 
% % [Abar,Bbar,Cbar,T,k] = ctrbf(sys.A,sys.B,sys.C)
% 
% A = [-216.6  10.3    0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0 ;
%   10.3 -216.6  10.3    0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0 ;
%     0   10.3 -216.6  10.3    0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0 ;
%     0     0   10.3 -216.6  10.3    0     0     0     0     0     0     0     0     0     0     0     0     0     0     0 ;
%     0     0     0   10.3 -216.6  10.3    0     0     0     0     0     0     0     0     0     0     0     0     0     0 ;
%     0     0     0     0   10.3 -216.6  10.3    0     0     0     0     0     0     0     0     0     0     0     0     0 ;
%     0     0     0     0     0   10.3 -216.6  10.3    0     0     0     0     0     0     0     0     0     0     0     0 ;
%     0     0     0     0     0     0   10.3 -216.6  10.3    0     0     0     0     0     0     0     0     0     0     0 ;
%     0     0     0     0     0     0     0   10.3 -216.6  10.3     0     0     0     0     0     0     0     0     0     0 ;
%     0     0     0     0     0     0     0     0   10.3 -216.6   10.3    0     0     0     0     0     0     0     0     0 ;
%     0     0     0     0     0     0     0     0     0   10.3  -216.6  10.3    0     0     0     0     0     0     0     0 ;
%     0     0     0     0     0     0     0     0     0     0   10.3 -216.6  10.3    0     0     0     0     0     0     0 ;
%     0     0     0     0     0     0     0     0     0     0     0   10.3 -216.6  10.3    0     0     0     0     0     0 ;
%     0     0     0     0     0     0     0     0     0     0     0     0   10.3 -216.6  10.3    0     0     0     0     0 ;
%     0     0     0     0     0     0     0     0     0     0     0     0     0   10.3 -216.6  10.3    0     0     0     0 ;
%     0     0     0     0     0     0     0     0     0     0     0     0     0     0   10.3 -216.6  10.3    0     0     0 ;
%     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0   10.3 -216.6  10.3    0     0 ;
%     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0   10.3 -216.6  10.3    0 ;
%     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0   10.3 -216.6  10.3;
%     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0   10.3 -216.6];
% 
% B = [[108.3   0. ]
%  [  0.    0. ]
%  [  0.    0. ]
%  [  0.    0. ]
%  [  0.    0. ]
%  [  0.    0. ]
%  [  0.    0. ]
%  [  0.    0. ]
%  [  0.    0. ]
%  [  0.    0. ]
%  [  0.    0. ]
%  [  0.    0. ]
%  [  0.    0. ]
%  [  0.    0. ]
%  [  0.    0. ]
%  [  0.    0. ]
%  [  0.    0. ]
%  [  0.    0. ]
%  [  0.    0. ]
%  [  0.  108.3]];
% 
% C = eye(20);
% 
% D = 0;
% 
% sys = ss(A,B,C,D);
% 
% Co = ctrb(sys.A,sys.B)
% unco = length(sys.A) - rank(Co)
% 
% 
% A = [1316.423,218.680,-3901.499,4476.847,-5040.135,-2111.942,10532.186,484.539,-7873.884,-5422.477,6532.657,7150.517,-6223.806,-1145.742,-1319.583,4700.185,-3854.379,1387.137,1363.642,-1175.477;
% 578.346,8.650,-1515.445,1721.207,-1760.871,-1098.072,4049.051,159.442,-2674.971,-1963.798,2219.271,2295.012,-2151.018,104.671,-765.076,1574.180,-1353.458,620.370,316.098,-331.685;
% -30.670,-210.532,460.662,-431.293,1130.964,-1223.415,0,-796.093,1620.378,937.546,-1497.185,-1368.808,1378.376,492.305,-51.732,-959.495,884.832,-316.759,-335.088,291.537;
% -375.208,-408.008,1580.334,-1438.506,3106.510,-2995.504,0,-2540.515,4044.542,2681.410,-3858.712,-2889.792,3661.349,-315.078,704.480,-2361.161,2751.762,-1835.706,0,423.002;
% -449.839,-393.391,1725.204,-1539.269,3079.395,-2844.985,0,-2656.266,3909.298,2666.839,-3804.173,-2441.999,3645.242,-1146.207,1152.171,-2155.534,2467.207,-1598.122,-78.412,395.331;
% -326.349,-63.317,1038.194,-1167.664,944.171,1037.677,-2692.580,43.326,1393.917,1063.429,-1222.730,-886.443,1209.234,-779.859,752.139,-704.309,751.635,-558.999,91.604,51.500;
% -107.226,1414.092,-3941.821,5870.186,-7251.994,7722.948,-6530.022,5254.181,-845.676,-8797.247,13311.059,-8062.621,2064.174,1870.653,-3111.729,564.128,0,2259.589,-1899.221,314.453;
% 987.155,0,-5431.838,11666.327,-16686.044,14923.090,-5611.809,0,5260.233,-18330.567,24791.768,-16743.130,5047.479,5663.884,-7003.928,-2965.187,6617.377,-1018.844,-1010.187,0;
% -86.808,5746.112,-17059.553,24581.243,-27725.745,26856.941,-23030.007,19596.045,-1875.672,-33413.190,52103.702,-37554.016,9404.457,16341.804,-19214.056,0,8246.485,0,-3284.925,783.053;
% 247.392,148.493,-1045.612,1195.227,-951.598,-1018.647,2678.482,-31.146,-1461.486,-1106.686,1251.875,965.797,-1195.844,711.116,-736.136,730.004,-761.772,546.794,-128.946,-12.456;
% -14.463,23.466,-88.867,39.174,693.875,-987.389,-58.159,-226.039,1216.700,557.367,-954.720,-1777.138,815.895,2080.431,-815.025,-1002.888,492.576,350.845,-852.408,504.284;
% -3675.625,9301.381,-13424.674,16656.871,-3922.887,-21352.028,22675.153,-905.509,-7815.743,1292.576,2107.158,-4179.663,14749.323,-28251.969,25760.487,-11611.879,14550.761,-30968.122,27819.034,-8819.168;
% -2139.659,4803.385,-6247.482,7673.199,-822.714,-10789.307,9509.445,-562.426,-2134.698,2058.554,-1018.794,-4019.715,10362.735,-14093.181,9091.343,0,2997.754,-14260.788,13898.206,-4388.051;
% -348.444,0,-42.783,2022.685,-372.534,-4379.857,3971.374,-230.475,-1127.340,899.804,-108.844,-1400.785,4273.501,-7808.297,7041.791,-3219.688,4034.777,-8116.474,7241.139,-2348.161;
% 61.063,-104.309,166.991,-131.925,-655.186,1065.785,-115.748,309.497,-1109.303,-559.027,816.395,1808.935,-718.031,-2249.658,849.189,1045.034,-446.446,-424.988,995.232,-604.838;
% 291.612,-51.533,-587.237,872.061,-2098.178,1120.339,2075.383,434.434,-3268.688,-1905.966,2766.892,3950.039,-2746.582,-3122.911,2162.597,82.451,0,0,788.334,-724.695;
% 333.820,47.962,-928.313,1185.301,-2172.423,571.491,2914.204,392.101,-3542.459,-2145.927,2858.054,4050.010,-2562.813,-2832.673,532.949,2545.210,-1635.432,-26.140,1317.575,-876.582;
% 160.426,78.511,-612.297,745.239,-928.389,-190.276,1715.865,103.716,-1499.664,-987.558,1228.566,1484.109,-1096.714,-564.387,-116.748,964.395,-721.780,180.576,237.706,-168.692;
% -204.988,69.966,279.034,-417.851,1489.095,-1105.673,-1235.179,-347.405,2440.758,1332.753,-1958.013,-3147.691,1769.954,2986.868,-935.569,-1949.173,1085.275,322.681,-1472.847,980.355;
% -605.406,-192.170,1433.578,-1432.719,5454.619,-6240.556,0,-3608.674,7840.431,4613.900,-6902.567,-8218.354,6301.160,5600.673,-1269.047,-5702.860,4180.380,-566.287,-3030.148,2265.607];
% 
% B = [4.701 0;
% 4.247 0;
% 3.713 0.001;
% 3.120 0.003;
% 2.527 0.007;
% 1.960 0.015;
% 1.439 0;
% 1.009 0;
% 0.665 0;
% 0.402 0.234;
% 0.235 0.404;
% 0.685 0;
% 1.053 0;
% 1.476 0;
% 0.015 1.995;
% 0.007 2.590;
% 0.003 3.190;
% 0.001 3.744;
% 4.252 0;
% 4.711 0]
% 
% C = eye(20);
% 
% D = 0;
% 
% sys = ss(A,B,C,D);
% 
% Co = ctrb(sys.A,sys.B)
% unco = length(sys.A) - rank(Co)
% 

A = [-6.815 -3.198 3.796;
    46.374 7.060 28.011;
    12.406 5.897 -3.365];
B = [0.691 -0.654;
    -0.761 -34.936
    -3.547 -2.327];
C = [1 0 0;
    0 1 0;
    0 0 1];
D = 0;

sys = ss(A,B,C,D);

Co = ctrb(sys.A,sys.B)
unco = length(sys.A) - rank(Co)

figure
[y1,t1] = impulse(sys,0:0.01:200);
subplot(2,2,1)
stairs(y1(:,1,1),'LineWidth',2);
hold on
ylabel('y_0')
title('u_0')
set(gca,'XLim',[0 60]);
grid on
subplot(2,2,2)
stairs(y1(:,1,2),'LineWidth',2);
hold on
title('u_1')
set(gca,'XLim',[0 60]);
grid on
subplot(2,2,3)
stairs(y1(:,2,1),'LineWidth',2);
hold on
xlabel('t')
ylabel('y_1')
set(gca,'XLim',[0 60]);
grid on
subplot(2,2,4)
stairs(y1(:,2,2),'LineWidth',2);
hold on
xlabel('t')
set(gca,'XLim',[0 60]);
grid on
subplot(2,2,2)
legend('Full model, n=20',['Balanced POD, r=',num2str(r)])
set(gcf,'Position',[100 100 550 350])
set(gcf,'PaperPositionMode','auto')

[U, S, V] = svd(Co, 'econ')

e = eig(sys.A)